---
layout: post
title:  "Angular1.x实践总结"
categories: Web
tags:  Frontend Angular
author: May
---

* content
{:toc}

## **Angular1.x实践总结**

### **Why Angular**

进入公司的第一个前后端分离项目，在Angular1.x和React之间选型。主要从两个方面考虑：

#### **框架本身的问题**

* 成熟度、背后支持

* 具备的功能

* 采用什么架构和模式

* 生态系统是否丰富

#### **需要自我反思的问题：**

* 团队是否能轻松学习并掌握

* 是否适合项目

* 开发体验是否足够好

从框架功能上来讲，两个都具备一些相同的核心功能：组件化、数据绑定以及平台无关的Render机制。

#### **Angular**
Angular除了提供一些需要最新浏览器支持的功能外，同时提供了

* 依赖注入

* 模板

* 路由

* ajax

* 表单

* 组件化CSS封装

* XSS保护

* 单元测试工具

#### **React**
相对Angular，React提供的功能就相对“简约”：

* 无依赖注入

* 使用JSX代替传统的HTML Templates

* XSS保护

* 单元测试工具

从语言与模式上来讲，Angular使用的对象都是传统的POJO对象，React使用JSX语法，这种在javascript中编写HTML标记的语言通常容易成为诟病。

## **项目结构**
***

目录build、release主要放置编译、打包压缩后的前端代码，mocks是基于express编写的模拟服务restful接口，与前端页面服务分处于不同端口不同域下，因此express需要进行CORS跨域处理。partials目录用来存放全部工程代码，项目结构如下：

![](./images/structure.png '项目结构')

每个业务模块将javascript、css样式和html分离编写，css采用scss进行预编译。在gulp中配置命令合并全部scss文件后再处理成css文件，便于colors、resets全局变量共享。

## **Index索引页**
***

index.html是一个标准的h5页面，但是内置了URL的配置模块，方便实施人员根据现场服务环境，对后端接口地址进行配置修改。但更好的实践是单独将其作为一个配置文件引入，代价是需要调整打包策略，避免gulp对其进行压缩混淆操作。

![](./images/index.png 'index')

## **App程序启动点**
***

app.js是整个程序的入口点，gulp自动化压缩后会作为bundle.js文件最顶部的一段代码，因此这里开启javascript严格模式后全局有效。每个js文件都使用立即调用函数表达式**IIFE**（***Immediately-Invoked Function Expression***）进行封装，防止局部变量泄漏到全局。

![](./images/app.png 'app')

## **Module**
***

Angular module中的路由配置是整个前端的切割点，通过它完成了整个单页面应用在源码层的文件切分。路由是几乎所有的MVC（VM）框架都应该具有的特性，它是所有单页面应用（SPA）必不可少的组成部分。对于angular1也有内置的路由模块ngRoute，但是它难以解决多视图和嵌套视图的问题，所以项目中使用了ui-router作为路由解决方案。每一个路由都可以理解为一个state，$stateProvider.state(...)方法，它做了些什么工作？
1. 首先，创建并存储一个state对象，里面包含该路由规则的所有配置信息。
2. 然后，调用$urlRouteProvider.when(...)方法，进行路由的注册。
3. 当hash值与state.url相匹配时，就跳转到该state。
为什么说跳转到该state，而不是url？ui.router是基于state（状态）的，而不是url。
$urlRouteProvider.when(...)方法，它做了哪些事情呢？
**路由的查找匹配**
这得从

![](./images/controller.png 'controller')